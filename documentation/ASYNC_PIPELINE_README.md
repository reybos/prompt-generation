# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Pipeline —Å FAL.AI Queue

## –û–±–∑–æ—Ä

–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è `longStudyPipeline` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å FAL.AI –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `src/pipeline/longStudyPipelineAsync.ts` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è pipeline
- `src/services/falQueueService.ts` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—å—é

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/pipeline/longStudyPipeline.ts` - –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
- `src/chains/chainFactory.ts` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫
- `src/pipeline/index.ts` - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
```
–ó–∞–ø—Ä–æ—Å 1 ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç 1 ‚Üí –ó–∞–ø—Ä–æ—Å 2 ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç 2 ‚Üí ...
```

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
```
–ó–∞–ø—Ä–æ—Å 1 ‚Üí Queue ‚Üí –ó–∞–ø—Ä–æ—Å 2 ‚Üí Queue ‚Üí –ó–∞–ø—Ä–æ—Å 3 ‚Üí Queue ‚Üí ...
                ‚Üì
            –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
                ‚Üì
            –°–±–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - –ï—Å–ª–∏ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–∞–¥–∞–µ—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –æ—á–µ—Ä–µ–¥—å

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```typescript
import { runContentPipeline } from './src/pipeline/longStudyPipeline.js';

const topics = {
    "science": ["How does photosynthesis work?"],
    "technology": ["What is AI?"]
};

const options = {
    channelName: "My Channel",
    emitLog: (message, requestId) => console.log(message),
    requestId: "unique-request-id"
};

const results = await runContentPipeline(topics, options);
```

### –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
```typescript
import { runContentPipelineAsync } from './src/pipeline/longStudyPipelineAsync.js';

const results = await runContentPipelineAsync(topics, options);
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

Pipeline –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `emitLog`:

```
üöÄ Starting async generation for "How does photosynthesis work?"... (Attempt 1)
üìù Script request submitted for "How does photosynthesis work?" (ID: req_123)
‚úÖ Script completed for "How does photosynthesis work?"
üñºÔ∏è Media prompts request submitted for "How does photosynthesis work?" (ID: req_124)
‚úÖ Media prompts completed for "How does photosynthesis work?"
üöÄ Parallel requests submitted for "How does photosynthesis work?": Enhanced Media, Music, Title, Hashtags
‚úÖ Enhanced media completed for "How does photosynthesis work?"
‚úÖ Async generation finished for "How does photosynthesis work?"
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
node test-async-pipeline.js
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –≤–∞—à–µ–º `.env` —Ñ–∞–π–ª–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω FAL API –∫–ª—é—á:
```
FAL_API_KEY=your_fal_api_key_here
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É video prompts –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ü–µ–Ω –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
- –û—á–∏—â–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –ø–∞–º—è—Ç–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 50-70% –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –î–æ 4-6 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º API. –ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç–µ –∏–º–ø–æ—Ä—Ç:

```typescript
// –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (–≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
import { runContentPipeline } from './src/pipeline/longStudyPipeline.js';

// –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
import { runContentPipelineAsync } from './src/pipeline/longStudyPipelineAsync.js';
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–ø—Ä–æ—Å—ã –∑–∞–≤–∏—Å–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FAL API –∫–ª—é—á –∏ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
**–†–µ—à–µ–Ω–∏–µ**: Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö prompts

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ü–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**: Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π
